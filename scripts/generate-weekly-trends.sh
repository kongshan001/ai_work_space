#!/bin/bash
# GitHub Weekly Trends Report Generator
# Run at 20:00 on Sunday (GMT+8)

set -e

# Script directory
SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
WORKSPACE_DIR="$(dirname "$SCRIPT_DIR")"
REPORTS_DIR="$WORKSPACE_DIR/reports/github-trends"
WEEKLY_DIR="$REPORTS_DIR/weekly"

# Create weekly directory if not exists
mkdir -p "$WEEKLY_DIR"

# Generate date strings
TODAY=$(date +%Y-%m-%d)
TIME=$(date +'%H:%M:%S')

# Calculate week info
WEEK_NUM=$(date +%U)
YEAR=$(date +%Y)

# Calculate start and end of week
# Start of week: Monday
WEEK_START=$(date -d "monday" +%Y-%m-%d)
WEEK_END=$(date -d "sunday" +%Y-%m-%d)

echo "[$(TZ='Asia/Shanghai' date +'%Y-%m-%d %H:%M:%S')] Starting weekly GitHub trends report generation (Week $WEEK_NUM, $YEAR)..."

# Create weekly report file
WEEKLY_FILE="$WEEKLY_DIR/github-trends-weekly-$YEAR-W$(printf '%02d' $WEEK_NUM).md"

# Generate report content
cat > "$WEEKLY_FILE" << HEADER
# GitHub æ¯å‘¨è¶‹åŠ¿ - $YEAR ç¬¬ $(printf '%02d' $WEEK_NUM) å‘¨

**å‘å¸ƒæ—¥æœŸ**ï¼š$TODAY
**å‘å¸ƒæ—¶é—´**ï¼š$TIME (GMT+8)
**ç»Ÿè®¡å‘¨æœŸ**ï¼š$WEEK_START è‡³ $WEEK_END

---

## ðŸ“Š æ‰§è¡Œæ‘˜è¦

æœ¬å‘¨ GitHub è¶‹åŠ¿æ ¸å¿ƒæ´žå¯Ÿï¼š

- **çƒ­é—¨é¢†åŸŸ**ï¼š[æœ¬å‘¨æœ€çƒ­é—¨çš„æŠ€æœ¯é¢†åŸŸ]
- **è¶‹åŠ¿å˜åŒ–**ï¼š[å¯¹æ¯”ä¸Šå‘¨çš„ä¸»è¦å˜åŒ–]
- **æ–°å…´é¡¹ç›®**ï¼š[æœ¬å‘¨æ–°å‡ºçŽ°çš„çƒ­é—¨é¡¹ç›®]
- **å¼€å‘è€…è¡Œä¸º**ï¼š[è§‚å¯Ÿåˆ°çš„å¼€å‘è€…æ´»åŠ¨è¶‹åŠ¿]

---

## ðŸ”¥ æœ¬å‘¨ Top 50 çƒ­é—¨é¡¹ç›®

### AI é¢†åŸŸ Top 15

| æŽ’å | é¡¹ç›® | æœ¬å‘¨ Stars | æ€» Stars | ä¸»è¦æ ‡ç­¾ | ç®€ä»‹ |
|------|------|-----------|----------|----------|------|
| 1 | [project-name](url) | +0 | 0 | tags | ç®€çŸ­æè¿° |
| 2 | [project-name](url) | +0 | 0 | tags | ç®€çŸ­æè¿° |

### ç¼–ç¨‹å·¥å…· Top 10

| æŽ’å | é¡¹ç›® | æœ¬å‘¨ Stars | æ€» Stars | ä¸»è¦æ ‡ç­¾ | ç®€ä»‹ |
|------|------|-----------|----------|----------|------|
| 1 | [project-name](url) | +0 | 0 | tags | ç®€çŸ­æè¿° |

### åŸºç¡€è®¾æ–½ Top 10

| æŽ’å | é¡¹ç›® | æœ¬å‘¨ Stars | æ€» Stars | ä¸»è¦æ ‡ç­¾ | ç®€ä»‹ |
|------|------|-----------|----------|----------|------|
| 1 | [project-name](url) | +0 | 0 | tags | ç®€çŸ­æè¿° |

### å…¶ä»–é¢†åŸŸ Top 15

| æŽ’å | é¡¹ç›® | æœ¬å‘¨ Stars | æ€» Stars | ä¸»è¦æ ‡ç­¾ | ç®€ä»‹ |
|------|------|-----------|----------|----------|------|
| 1 | [project-name](url) | +0 | 0 | tags | ç®€çŸ­æè¿° |

---

## â­ æœ¬å‘¨ Star å¢žé•¿æœ€å¿«

### æŒ‰ç»å¯¹å¢žé•¿

| é¡¹ç›® | æœ¬å‘¨å¢žé•¿ | æ€» Stars | é¢†åŸŸ |
|------|----------|----------|------|
| [project-name](url) | +0 | 0 | é¢†åŸŸ |

### æŒ‰å¢žé•¿çŽ‡

| é¡¹ç›® | å¢žé•¿çŽ‡ | æœ¬å‘¨å¢žé•¿ | é¢†åŸŸ |
|------|--------|----------|------|
| [project-name](url) | 0% | +0 | é¢†åŸŸ |

---

## ðŸŒŸ æ·±åº¦é¡¹ç›®åˆ†æž

### 1. [é¡¹ç›®åç§°](é¡¹ç›®é“¾æŽ¥)

**åˆ†ç±»**ï¼š[é¢†åŸŸ]
**æœ¬å‘¨æŽ’å**ï¼šç¬¬ X å
**æ€» Stars**ï¼š[æ€»æ•°]

#### é¡¹ç›®ç®€ä»‹

[è¯¦ç»†ä»‹ç»é¡¹ç›®çš„ä¸»è¦åŠŸèƒ½ã€æŠ€æœ¯ç‰¹ç‚¹å’Œåˆ›æ–°ç‚¹]

#### æŠ€æœ¯æ ˆ

- [æŠ€æœ¯ 1]ï¼š[ç”¨é€”]
- [æŠ€æœ¯ 2]ï¼š[ç”¨é€”]

#### ä¸ºä»€ä¹ˆæœ¬å‘¨çˆ†å‘ï¼Ÿ

- [åŽŸå›  1]
- [åŽŸå›  2]

#### æœ€ä½³å®žè·µåœºæ™¯

**åœºæ™¯ 1ï¼š[å…·ä½“åœºæ™¯]**
\`\`\`bash
# ä½¿ç”¨ç¤ºä¾‹
command --option value
\`\`\`

**åœºæ™¯ 2ï¼š[å…·ä½“åœºæ™¯]**
\`\`\`python
# ä»£ç ç¤ºä¾‹
import library
\`\`\`

#### æ³¨æ„äº‹é¡¹

- âš ï¸ [é™åˆ¶ 1]
- âš ï¸ [é™åˆ¶ 2]

#### æ›¿ä»£æ–¹æ¡ˆ

- [æ›¿ä»£é¡¹ç›® 1](url)ï¼š[ç®€çŸ­å¯¹æ¯”]
- [æ›¿ä»£é¡¹ç›® 2](url)ï¼š[ç®€çŸ­å¯¹æ¯”]

---

## ðŸ“ˆ è¶‹åŠ¿åˆ†æž

### æŠ€æœ¯é¢†åŸŸå¯¹æ¯”

| é¢†åŸŸ | æœ¬å‘¨çƒ­é—¨é¡¹ç›®æ•° | Star å¢žé•¿ | è¶‹åŠ¿æ–¹å‘ |
|------|---------------|-----------|----------|
| AI | 15 | +0 | â†—ï¸ ä¸Šå‡ |
| ç¼–ç¨‹å·¥å…· | 10 | +0 | â†’ ç¨³å®š |
| åŸºç¡€è®¾æ–½ | 10 | +0 | â†˜ï¸ ä¸‹é™ |

### å¯¹ä¸Šå‘¨å˜åŒ–

**æ–°å…´é¢†åŸŸ**ï¼š
- [é¢†åŸŸ 1]ï¼šä»Žä¸Šå‘¨ç¬¬ X ä½ä¸Šå‡åˆ°ç¬¬ Y ä½
- [é¢†åŸŸ 2]ï¼šæœ¬å‘¨æ–°å‡ºçŽ°çš„çƒ­é—¨é¢†åŸŸ

**è¡°é€€é¢†åŸŸ**ï¼š
- [é¢†åŸŸ 1]ï¼šçƒ­åº¦ä¸‹é™

**æŠ€æœ¯å…³é”®è¯å˜åŒ–**ï¼š
- ä¸Šå‘¨çƒ­é—¨ï¼š[å…³é”®è¯åˆ—è¡¨]
- æœ¬å‘¨çƒ­é—¨ï¼š[å…³é”®è¯åˆ—è¡¨]

---

## ðŸ’¡ å¼€å‘è€…è¡Œä¸ºæ´žå¯Ÿ

### è´¡çŒ®è€…æ´»è·ƒåº¦

- **å¹³å‡å‘¨æ´»è·ƒè´¡çŒ®è€…**ï¼š[æ•°å­—]
- **æœ€æ´»è·ƒé¡¹ç›®**ï¼š[é¡¹ç›®å] ([æ•°å­—] è´¡çŒ®è€…)

### Issue å’Œ PR æ´»åŠ¨

- **æ–°å¢ž Issue**ï¼š[æ•°å­—]
- **åˆå¹¶ PR**ï¼š[æ•°å­—]
- **æœ€æ´»è·ƒç¤¾åŒº**ï¼š[é¡¹ç›®å]

### Fork å’Œ Clone è¡Œä¸º

- **è¢« Fork æœ€å¤šçš„é¡¹ç›®**ï¼š[é¡¹ç›®å] ([æ•°å­—] æ¬¡)
- **å¼€å‘è€…å…³æ³¨ç‚¹**ï¼š[åˆ†æž]

---

## ðŸ†• æ–°å‘çŽ°çš„ä¼˜ç§€é¡¹ç›®

### æœ¬å‘¨æ–°ä¸Šæ¦œé¡¹ç›®

- **[é¡¹ç›®å](url)**ï¼š[æè¿°] - [æŽ¨èæŒ‡æ•° â˜…â˜…â˜…â˜…â˜†]
- **[é¡¹ç›®å](url)**ï¼š[æè¿°] - [æŽ¨èæŒ‡æ•° â˜…â˜…â˜…â˜…â˜†]

### å€¼å¾—é•¿æœŸå…³æ³¨çš„é¡¹ç›®

**åˆ—å…¥è§‚å¯Ÿåˆ—è¡¨**ï¼š
- [é¡¹ç›® 1](url)ï¼š[åŽŸå› ]
- [é¡¹ç›® 2](url)ï¼š[åŽŸå› ]

---

## ðŸ“š æŽ¨èé˜…è¯»

### æœ¬å‘¨çƒ­é—¨åšå®¢æ–‡ç« 

- [æ–‡ç« æ ‡é¢˜](url)ï¼š[ç®€çŸ­æè¿°]
- [æ–‡ç« æ ‡é¢˜](url)ï¼š[ç®€çŸ­æè¿°]

### GitHub Discussions çƒ­é—¨è¯é¢˜

- [è®¨è®ºä¸»é¢˜](url)ï¼š[è§‚ç‚¹æ‘˜è¦]

---

## ðŸ”® ä¸‹å‘¨é¢„æµ‹

åŸºäºŽæœ¬å‘¨è¶‹åŠ¿ï¼Œé¢„è®¡ä¸‹å‘¨ï¼š

- **çƒ­é—¨é¢†åŸŸ**ï¼š[é¢„æµ‹çš„é¢†åŸŸ]
- **å¯èƒ½çˆ†å‘çš„é¡¹ç›®**ï¼š[é¢„æµ‹]
- **æŠ€æœ¯è¶‹åŠ¿**ï¼š[é¢„æµ‹]

---

## ðŸ”— ç›¸å…³èµ„æº

- **GitHub Trending**ï¼šhttps://github.com/trending
- **é¡¹ç›®è¯¦æƒ…**ï¼šæŸ¥çœ‹ `projects/` ç›®å½•
- **æ—¥æŠ¥å½’æ¡£**ï¼š`daily/` ç›®å½•
- **æœˆåº¦æŠ¥å‘Š**ï¼š`monthly/` ç›®å½•

---

**æŠ¥å‘Šç”Ÿæˆ**ï¼šOpenClaw AI Agent
**æ›´æ–°é¢‘çŽ‡**ï¼šæ¯å‘¨æ—¥ 20:00 (GMT+8)
**å½’æ¡£æœŸé™**ï¼š4 å‘¨
HEADER

echo "[$(TZ='Asia/Shanghai' date +'%Y-%m-%d %H:%M:%S')] Weekly report generated: $WEEKLY_FILE"

# Commit to git
cd "$WORKSPACE_DIR"
git add "$WEEKLY_FILE"
if git diff --cached --quiet; then
    echo "No changes to commit"
else
    git commit -m "Auto: Add weekly GitHub trends report for $YEAR-W$(printf '%02d' $WEEK_NUM)"
    git push origin master
    echo "[$(TZ='Asia/Shanghai' date +'%Y-%m-%d %H:%M:%S')] Report committed and pushed to GitHub"
fi

echo "[$(TZ='Asia/Shanghai' date +'%Y-%m-%d %H:%M:%S')] Weekly trends generation completed"
